## Documentación técnica: PharmaCold Track
Autoría: Elmer Augusto Riva Rodriguez Perfil: Ingeniero de Software Fecha: 27/12/2025

### 1. Caso de partida

#### 1.1. Caso de negocio: Sistema de control para logística farmacéutica
La empresa de transporte logístico PharmaCold está enfrentando problemas serios con el manejo de productos sensibles a la temperatura, como vacunas y medicinas especializadas. Actualmente, se necesita una plataforma digital que permita registrar y gestionar cada envío individual que sale de sus almacenes. El requerimiento principal es que, al momento de crear un nuevo envío en el sistema, el operador logístico pueda definir no solo los datos básicos de origen y destino, sino también el rango de temperatura seguro específico para ese producto (temperatura mínima y máxima permitida).

Una vez que el envío está en tránsito, se debe tener la capacidad de reportar actualizaciones periódicas o "puntos de control" que incluyan la fecha, la ubicación actual y, lo más importante, la temperatura registrada en ese momento.

Aquí está el punto crítico que se necesita resolver: el sistema debe ser capaz de evaluar automáticamente estas lecturas. Si en algún momento se registra una temperatura fuera del rango establecido inicialmente, el sistema debe realizar dos acciones inmediatas sin intervención humana:

1. Cambiar el estado del envío a "Comprometido" para asegurar que el producto no sea entregado al cliente final por error.

2. Enviar una alerta por correo electrónico al administrador logístico informando sobre la ruptura de la cadena de frío, detallando la ubicación y temperatura registrada para una rápida toma de decisiones.

Finalmente, se necesita poder consultar el historial completo de cada envío para ver su trazabilidad y saber exactamente en qué punto de la ruta ocurrió una incidencia si la hubo.

#### 1.2. Declaración de usuarios
Para acotar el alcance del MVP, he identificado dos actores principales que interactúan con el sistema:

**Operador logístico (Admin):** Responsable de dar de alta los envíos desde el centro de distribución y monitorear el estado general de la flota.

**Transportista / sensor IoT:** En este escenario, representa la fuente de datos que envía las lecturas de telemetría (ubicación y temperatura) durante el trayecto.

### 2. Product backlog

| Story ID | Título                                       | Descripción                                                                                                                                                                                        | Criterios de aceptación                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
|----------|----------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| US01     | **Registro de nuevo envío (Shipment)**       | Como operador logístico, quiero registrar un nuevo envío en el sistema definiendo sus metadatos y rangos de seguridad, para iniciar el ciclo de vida de transporte monitoreado.                    | **Escenario 1: Registro exitoso (Happy Path)**<br>Given el operador tiene los datos del envío<br>When ingresa Descripción="Vacunas COVID", TempMin=2.0, TempMax=8.0<br>Then el sistema crea el envío con estado "CREATED"<br>And genera un ID único de seguimiento (UUID).<br><br>**Escenario 2: Validación de rangos inválidos (Unhappy Path)**<br>Given el operador intenta crear un envío<br>When ingresa TempMin=10.0 y TempMax=5.0<br>Then el sistema rechaza la operación<br>And muestra el error "La temperatura mínima no puede ser mayor a la máxima".<br><br>**Escenario 3: Datos incompletos (Unhappy Path)**<br>Given el operador omite el cliente destinatario<br>When intenta guardar<br>Then el sistema muestra error de "Campos obligatorios requeridos".                                                                                      |
| US02     | **Cambio de estado a "En tránsito"**         | Como operador logístico, quiero cambiar el estado del envío a "IN_TRANSIT" cuando el camión sale del almacén, para habilitar la recepción de lecturas de sensores.                                 | **Escenario 1: Despacho exitoso (Happy Path)**<br>Given un envío en estado "CREATED"<br>When el operador selecciona "Iniciar Transporte"<br>Then el estado cambia a "IN_TRANSIT".<br><br>**Escenario 2: Transición ilegal (Unhappy Path)**<br>Given un envío que ya fue finalizado ("DELIVERED")<br>When el operador intenta iniciarlo nuevamente<br>Then el sistema bloquea la acción indicando que el flujo ya concluyó.                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| US03     | **Registro de telemetría (Checkpoint)**      | Como sensor IoT (sistema externo), quiero enviar lecturas periódicas de ubicación y temperatura al sistema, para mantener la trazabilidad del activo en tiempo real.                               | **Escenario 1: Lectura válida (Happy Path)**<br>Given un envío existente en estado "IN_TRANSIT"<br>When el sensor envía {Lat: -12.04, Lon: -77.04, Temp: 5.0, Date: Now}<br>Then el sistema registra el checkpoint asociado al envío<br>And responde con código HTTP 201 (Created).<br><br>**Escenario 2: Envío inexistente (Unhappy Path)**<br>Given un ID de envío incorrecto<br>When el sensor envía datos<br>Then el sistema responde con error HTTP 404 (Not Found).<br><br>**Escenario 3: Datos corruptos (Unhappy Path)**<br>Given una lectura sin datos de temperatura<br>When el sensor envía la petición<br>Then el sistema rechaza la solicitud (Bad Request).                                                                                                                                                                                      |
| US04     | **Evaluación automática de integridad**      | Como sistema (backend), quiero evaluar cada nueva lectura de temperatura contra los límites configurados del envío, para determinar automáticamente si la cadena de frío se ha roto.               | **Escenario 1: Temperatura dentro de rango (Happy Path)**<br>Given un envío con rango [2.0, 8.0] en estado "IN_TRANSIT"<br>When llega una lectura de 5.0 grados<br>Then se registra el checkpoint<br>And el estado del envío se mantiene en "IN_TRANSIT".<br><br>**Escenario 2: Violación de Límite superior (Business rule)**<br>Given un envío con rango [2.0, 8.0] en estado "IN_TRANSIT"<br>When llega una lectura de 9.5 grados<br>Then el sistema cambia automáticamente el estado del envío a "COMPROMISED"<br>And registra el evento de dominio "ChainOfColdBroken".<br><br>**Escenario 3: Persistencia de falla (Invariante)**<br>Given un envío que ya está en estado "COMPROMISED"<br>When llega una nueva lectura perfecta de 4.0 grados<br>Then se registra el checkpoint<br>But el estado del envío PERMANECE en "COMPROMISED" (no se recupera). |
| US05     | **Consulta de historial y estado**           | Como operador logístico, quiero ver el detalle de un envío y su lista de checkpoints, para auditar qué sucedió durante el transporte.                                                              | **Escenario 1: Consulta detallada (Happy Path)**<br>Given un envío con 5 registros de telemetría<br>When el usuario solicita el detalle<br>Then el sistema devuelve la información del envío, su estado actual<br>And una lista de 5 checkpoints ordenados cronológicamente descendente.<br><br>**Escenario 2: Visualización de alerta**<br>Given un envío en estado "COMPROMISED"<br>When el usuario ve el detalle<br>Then la interfaz debe indicar visualmente (flag rojo) que el producto no es apto.                                                                                                                                                                                                                                                                                                                                                       |
| US06     | **Finalización de envío (Delivery)**         | Como operador logístico, quiero marcar el envío como entregado cuando llega a destino, para cerrar el ciclo de monitoreo.                                                                          | **Escenario 1: Entrega exitosa (Happy Path)**<br>Given un envío en estado "IN_TRANSIT" o "COMPROMISED"<br>When el operador registra la entrega<br>Then el estado cambia a "DELIVERED".<br><br>**Escenario 2: Cierre prematuro**<br>Given un envío que apenas fue creado ("CREATED")<br>When se intenta finalizar<br>Then el sistema impide la acción (debe pasar por tránsito primero).                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| US07     | **Alerta por correo de cadena de frio rota** | Como operador logístico, , quiero recibir un correo electrónico automático cuando un envío pase a estado "COMPROMISED", para tomar acciones correctivas inmediatas sin estar mirando la pantalla.  | **Escenario 1: Envío de alerta (Happy Path)**<br>Given un envío pasa a estado "COMPROMISED" debido a temperatura alta<br>When el sistema procesa el cambio de estado<br>Then se envía un correo al administrador con el Asunto: "ALERTA: Cadena de frío rota - Envío [ID]"<br>And el correo contiene la temperatura registrada y la ubicación.<br><br>**Escenario 2: Fallo en servidor de correo (Unhappy Path)**<br>Given el servicio de correo (SMTP) no responde<br>When ocurre una incidencia<br>Then el sistema debe registrar el error en el log (no debe caerse la aplicación)<br>And el estado del envío SÍ debe cambiar a "COMPROMISED" de todas formas.                                                                                                                                                                                              | 
